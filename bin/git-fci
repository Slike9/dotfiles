#!/bin/bash

set -e
set -u

issue_pattern="(PLRBT|GMTS)-[[:digit:]]+"

parse_issue() {
  echo $1 | grep -Eo "$issue_pattern"
}

msg_contains_issue() {
  echo $1 | grep -E "$issue_pattern"
}

message="$*"
if ! msg_contains_issue "$message"; then
  branch=$(git rev-parse --abbrev-ref HEAD)
  issue=$(parse_issue $branch)

  if [[ -z $issue ]]; then
    echo "issue not found" 1>&2
    exit 1
  fi

  message="$issue: $message"
fi

git commit -m "$message"
